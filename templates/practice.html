<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®Ÿé¨“</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <style>
        /* ãƒ¢ãƒ€ãƒ³ãªã‚«ãƒ©ãƒ¼ãƒ‘ãƒ¬ãƒƒãƒˆï¼ˆindex.htmlã¨åŒã˜ï¼‰ */
        :root {
            --primary-color: #667eea;
            --secondary-color: #764ba2;
            --accent-color: #f093fb;
            --gradient-bg: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --card-bg: rgba(255, 255, 255, 0.95);
            --text-primary: #2d3748;
            --text-secondary: #4a5568;
            --border-color: rgba(255, 255, 255, 0.2);
            --shadow-light: 0 10px 25px rgba(0, 0, 0, 0.1);
            --shadow-medium: 0 15px 35px rgba(0, 0, 0, 0.15);
        }

        /* ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³èƒŒæ™¯ */
        body {
            background: var(--gradient-bg) !important;
            min-height: 100vh;
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif !important;
        }

        /* ãƒ¡ã‚¤ãƒ³ã‚¿ã‚¤ãƒˆãƒ« */
        h1 {
            background: linear-gradient(45deg, #fff, #f0f8ff) !important;
            -webkit-background-clip: text !important;
            -webkit-text-fill-color: transparent !important;
            background-clip: text !important;
            text-shadow: 2px 2px 10px rgba(0, 0, 0, 0.3) !important;
            font-size: 2.5rem !important;
            font-weight: 700 !important;
            margin-bottom: 2rem !important;
            letter-spacing: -0.02em !important;
            text-align: center !important;
        }

        /* èª¬æ˜æ–‡ã‚«ãƒ¼ãƒ‰ */
        .instruction,
        .instruction-start {
            background: rgba(255, 255, 255, 0.95) !important;
            border: 1px solid rgba(255, 255, 255, 0.3) !important;
            border-radius: 24px !important;
            padding: 2.5rem !important;
            margin: 2rem auto !important;
            box-shadow: var(--shadow-medium) !important;
            backdrop-filter: blur(15px) !important;
            max-width: 900px !important;
            width: 90% !important;
        }

        /* ç·´ç¿’å•é¡Œã‚³ãƒ³ãƒ†ãƒŠ */
        .container {
            background: rgba(255, 255, 255, 0.9) !important;
            border-radius: 20px !important;
            padding: 2rem !important;
            margin: 2rem auto !important;
            max-width: 700px !important;
            width: 90% !important;
            box-shadow: var(--shadow-medium) !important;
            border: 1px solid rgba(255, 255, 255, 0.3) !important;
            backdrop-filter: blur(15px) !important;
            display: flex !important;
            flex-direction: column !important;
            align-items: center !important;
        }

        /* ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã‚³ãƒ³ãƒ†ãƒŠ */
        .slider-container {
            position: relative;
            overflow: hidden;
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            backdrop-filter: blur(10px);
        }

        .slider-wrapper {
            display: flex;
            transition: transform 0.5s ease-in-out;
        }

        .slide {
            flex: 0 0 100%;
            box-sizing: border-box;
            padding: 2rem;
        }

        /* ãƒ«ãƒ¼ãƒ«è¡¨ç¤ºã®æ”¹å–„ */
        .rule {
            padding: 1.5rem;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(240, 147, 251, 0.1));
            border: 2px solid var(--primary-color);
            border-radius: 16px;
            box-shadow: var(--shadow-light);
            backdrop-filter: blur(10px);
        }

        .rule-heading {
            color: var(--primary-color);
            margin-top: 0;
            /* ä¸Šãƒãƒ¼ã‚¸ãƒ³ã‚’å‰Šé™¤ */
            margin-bottom: 1rem;
            font-size: 1.2rem;
            font-weight: 600;
        }

        /* ãƒ‰ãƒƒãƒˆã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ */
        .dots {
            text-align: center;
            margin: 0 1rem;
        }

        .dot {
            height: 12px;
            width: 12px;
            margin: 0 5px;
            background-color: rgba(255, 255, 255, 0.5);
            border-radius: 50%;
            display: inline-block;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .dot.active {
            background-color: var(--primary-color);
            transform: scale(1.2);
        }

        /* ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ */
        .dot-nav-wrapper {
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 2rem 0;
        }

        .dot-nav-wrapper .slide-nav {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            margin: 0 0.5rem;
        }

        .dot-nav-wrapper .slide-nav:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-light);
        }

        /* ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã‚³ãƒ³ãƒ†ãƒŠ */
        .dropdown-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 1rem;
            margin: 2rem 0;
            flex-wrap: wrap;
        }

        /* ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ */
        select {
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 12px;
            padding: 0.75rem 1rem;
            font-size: 1rem;
            color: var(--text-primary);
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
            min-width: 200px;
            text-align: center;
            width: 100%;
            max-width: 300px;
            box-sizing: border-box;
        }

        select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        /* ãƒœã‚¿ãƒ³ã‚¹ã‚¿ã‚¤ãƒ«ã®çµ±ä¸€ */
        .button,
        #startPracticeBtn,
        #replayTrialBtn {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)) !important;
            color: white !important;
            border: none !important;
            border-radius: 12px !important;
            padding: 0.75rem 1.5rem !important;
            font-size: 1rem !important;
            font-weight: 500 !important;
            cursor: pointer !important;
            transition: all 0.3s ease !important;
            box-shadow: var(--shadow-light) !important;
            min-width: 120px !important;
        }

        /* ã‚‚ã†ä¸€åº¦èããƒœã‚¿ãƒ³ã®ä¸­å¤®æƒãˆï¼ˆè¡¨ç¤º/éè¡¨ç¤ºã¯JSã§åˆ¶å¾¡ï¼‰ */
        #replayTrialBtn {
            margin: 1rem auto !important;
            width: 200px !important;
        }

        .button:hover,
        #startPracticeBtn:hover,
        #replayTrialBtn:hover {
            transform: translateY(-2px) !important;
            box-shadow: var(--shadow-medium) !important;
        }

        /* æœ¬ç•ªã¸ãƒœã‚¿ãƒ³ */
        #finishPractice {
            background: linear-gradient(135deg, #4CAF50, #45a049) !important;
            color: white !important;
            border: none !important;
            padding: 1.2rem 3rem !important;
            font-size: 1.2rem !important;
            font-weight: 600 !important;
            border-radius: 50px !important;
            cursor: pointer !important;
            transition: all 0.3s ease !important;
            box-shadow: var(--shadow-light) !important;
            margin: 2rem auto 4rem auto !important;
            display: block !important;
            text-transform: uppercase !important;
            letter-spacing: 0.5px !important;
        }

        #finishPractice:hover {
            transform: translateY(-3px) !important;
            box-shadow: var(--shadow-medium) !important;
        }

        /* é¸æŠçŠ¶æ…‹ã®ãƒœã‚¿ãƒ³ */
        .button.selected {
            background: linear-gradient(135deg, var(--accent-color), #ff6b9d) !important;
            transform: scale(1.05) !important;
        }

        /* ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒ†ã‚­ã‚¹ãƒˆ */
        .target-text {
            color: var(--accent-color) !important;
            font-weight: 600 !important;
        }

        /* çµæœè¡¨ç¤º */
        #resultText {
            color: var(--text-primary) !important;
            font-size: 1.2rem !important;
            font-weight: 600 !important;
            text-align: center !important;
            margin: 1rem 0 !important;
        }

        /* ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ */
        #error {
            color: #e53e3e !important;
            text-align: center !important;
            font-weight: 500 !important;
            margin: 1rem 0 !important;
        }

        /* å®Ÿä¾‹ã¨éŸ³å£°ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ */
        .trial-example {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 1rem;
            margin: 1.5rem 0;
        }

        .media-container {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 12px;
            padding: 1rem;
            box-shadow: var(--shadow-light);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            /* ä¸­å¤®æƒãˆï¼ˆæ¨ªæ–¹å‘ï¼‰ */
            gap: 0.5rem;
        }

        .media-container:hover {
            transform: scale(1.02);
        }

        /* éŸ³å£°å†ç”Ÿãƒœã‚¿ãƒ³ï¼ˆã‚·ãƒ³ãƒ—ãƒ«ãƒ‡ã‚¶ã‚¤ãƒ³ + ãƒ›ãƒãƒ¼åŠ¹æœï¼‰ */
        .play-button {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: none;
            background-color: lightgray;
            cursor: pointer;
            position: relative;
            margin: 10px;
            padding: 0;
            box-sizing: border-box;
            transition: all 0.3s ease;
        }

        /* ãƒ›ãƒãƒ¼åŠ¹æœ */
        .play-button:hover {
            background-color: var(--primary-color);
            transform: scale(1.1);
            box-shadow: var(--shadow-light);
        }

        /* å†ç”Ÿã‚¢ã‚¤ã‚³ãƒ³ï¼ˆä¸‰è§’å½¢ï¼‰ */
        .play-button::after {
            content: "";
            display: block;
            position: absolute;
            top: 50%;
            left: 55%;
            transform: translateY(-50%) translateX(-50%);
            border-top: 10px solid transparent;
            border-bottom: 10px solid transparent;
            border-left: 15px solid var(--primary-color);
            transition: border-left-color 0.3s ease;
        }

        .play-button:hover::after {
            border-left-color: white;
        }

        /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ */
        @media (max-width: 768px) {
            h1 {
                font-size: 2rem !important;
            }

            .instruction,
            .instruction-start,
            .container {
                padding: 1.5rem !important;
                margin: 1rem !important;
                width: 95% !important;
            }

            .slide {
                padding: 1rem !important;
            }

            .dropdown-container {
                flex-direction: column;
                gap: 1rem;
                width: 100%;
                align-items: center;
            }

            select {
                width: 100% !important;
                max-width: 280px !important;
            }

            #startPracticeBtn {
                width: 100% !important;
                max-width: 280px !important;
            }

            .dot-nav-wrapper {
                flex-wrap: wrap;
                gap: 1rem;
            }

            .dot-nav-wrapper .slide-nav {
                padding: 0.5rem 1rem;
                font-size: 0.9rem;
            }

            #finishPractice {
                padding: 1rem 2rem !important;
                font-size: 1rem !important;
                width: 90% !important;
                max-width: 300px !important;
            }

            /* #replayTrialBtn ã®è¡¨ç¤ºã¯JSã§åˆ¶å¾¡ã™ã‚‹ãŸã‚ã€ã“ã“ã§ã¯displayæŒ‡å®šã—ãªã„ */
        }

        @media (max-width: 480px) {

            /* Ensure block layout for mobile-only sections */
            .mobile-only { display: block !important; }

            .instruction,
            .instruction-start,
            .container,
            #instructionTopMobile,
            #instructionStart {
                width: 95% !important; /* leave breathing room from edges */
                max-width: 700px !important; /* align with practice container */
                margin: 0 auto 1rem auto !important; /* center and keep bottom spacing */
                padding: 1rem !important;
                box-sizing: border-box !important; /* include padding in width to avoid overflow */
            }

            .button {
                min-width: 100px !important;
                padding: 0.6rem 1rem !important;
            }
        }
    </style>
</head>

<body>
    <h1>ğŸƒâ€â™€ï¸ ç·´ç¿’å•é¡Œ</h1>
    <!-- éŸ³å£°è¦ç´  -->
    <audio id="tone1" preload="auto"></audio>
    <audio id="tone2" preload="auto"></audio>
    <audio id="tone3" preload="auto"></audio>

    <!-- èª¬æ˜æ–‡1 - PCç‰ˆ -->
    <div id="instructionTop" class="instruction pc-only">
        <h3>ã‚¯ã‚¤ã‚ºã®èª¬æ˜ (ä¾‹: éŸ³æ¡ä»¶ï¼’)</h3>
        <div class="slider-container">
            <div class="slider-wrapper">
                <!-- ã‚¹ãƒ©ã‚¤ãƒ‰1 -->
                <div class="slide">
                    <p>ã€Œã‚¿ã‚¿ã‚¿ã€ãŒï¼”å›é€£ç¶šã—ãŸã‚‚ã®ã‚’ï¼‘ã¤ã®éŸ³ã¨ã—ã¾ã™</p>
                    <div class="media-container">
                        <audio id="sample_audio_normal"
                            src="{{ url_for('static', filename='stimuli/successive_0.52*4/as_semitone/gallops_0.00ms.wav') }}"></audio>
                        <button class="play-button" onclick="playAudio('sample_audio_normal')"></button>
                        <img src="{{ url_for('static', filename='sample_fig/stimuli_normal.png') }}"
                            class="stimuli-img">
                    </div>
                    <p>ã“ã®éŸ³ã‚’ãƒãƒ¼ãƒãƒ«éŸ³ã¨ã—ã¾ã™</p>
                </div>
                <!-- ã‚¹ãƒ©ã‚¤ãƒ‰2 -->
                <div class="slide">
                    <p>ã“ã®éŸ³ãŒé–“ã‚’é–‹ã‘ã¦ã€3å›æµã‚Œã¾ã™</p>
                    <div class="media-container">
                        <button class="play-button" onclick="playSlide2Trial()"></button>
                        <img src="{{ url_for('static', filename='sample_fig/trial_target_third.png') }}"
                            class="example-img">
                    </div>
                    <p>ãƒãƒ¼ãƒãƒ«éŸ³ã€ãƒãƒ¼ãƒãƒ«éŸ³ã€ãƒãƒ¼ãƒãƒ«éŸ³ï¼Ÿ<br>3ã¤ç›®ã®éŸ³ã¯ãƒªã‚ºãƒ ãŒé•ã„ã¾ã™ã­ï¼
                    </p>
                </div>
                <!-- ã‚¹ãƒ©ã‚¤ãƒ‰3 -->
                <div class="slide">
                    <p>ã“ã®ã‚ˆã†ã«ãƒªã‚ºãƒ ã®å´©ã‚ŒãŸéŸ³ã‚’<span class="target-text">ã‚¿ãƒ¼ã‚²ãƒƒãƒˆéŸ³</span>ã¨ã—ã¾ã™</p>
                    <h4>çš†ã•ã‚“ã«ã¯ã“ã®<span class="target-text">ã‚¿ãƒ¼ã‚²ãƒƒãƒˆéŸ³</span>ã‚’å½“ã¦ã‚‹å•é¡Œã«æŒ‘æˆ¦ã—ã¦ã‚‚ã‚‰ã„ã¾ã™ï¼ï¼</h4>
                    <p>å®Ÿéš›ã®å•é¡Œã®ãƒ«ãƒ¼ãƒ«ã¯æ¬¡ã®ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™</p>
                    <ul class="rule">
                        <h5 class="rule-heading">å•é¡Œã®ãƒ«ãƒ¼ãƒ«</h5>
                        <li>ï¼“å›éŸ³ãŒæµã‚Œã¾ã™</li>
                        <li>ï¼‘ç•ªç›®ã‹ï¼“ç•ªç›®ã®ã©ã¡ã‚‰ã‹ä¸€æ–¹ãŒã‚¿ãƒ¼ã‚²ãƒƒãƒˆéŸ³ã§ã™</li>
                        <li>ï¼’ç•ªç›®ã¯å¿…ãšãƒãƒ¼ãƒãƒ«éŸ³ã§ã™</li>
                        <li>ã‚¿ãƒ¼ã‚²ãƒƒãƒˆéŸ³ã¯ã€é«˜ã„éŸ³ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ãŒå¾Œã‚ã«ãšã‚ŒãŸéŸ³ã§ã€Œã‚¿ãƒƒã‚¿ã‚¿ã€ã¨ã„ã†ãƒªã‚ºãƒ ã«ãªã‚Šã¾ã™ï¼ˆâ€»éŸ³æ¡ä»¶ï¼‘ã§ã¯ã‚ºãƒ¬ã‚‹éŸ³ã®é«˜ã•ã¯å‘¨ã‚Šã¨åŒã˜ã§ã™ï¼‰
                            <div class="media-container target-container">
                                <audio id="sample_audio_target"
                                    src="{{ url_for('static', filename='stimuli/successive_0.52*4/as_semitone/gallops_64.00ms.wav') }}"></audio>
                                <button class="play-button target-button"
                                    onclick="playAudio('sample_audio_target')"></button>
                                <img src="{{ url_for('static', filename='sample_fig/stimuli_target_v3.png') }}"
                                    class="stimuli-img target-img">
                            </div>
                        </li>
                    </ul>

                </div>
                <!-- ã‚¹ãƒ©ã‚¤ãƒ‰4 -->
                <div class="slide">
                    <h4>ç·´ç¿’å•é¡Œã«ä¸‹ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§å–ã‚Šçµ„ã‚“ã§ã¿ã¦ãã ã•ã„ï¼</h4>
                    <ul class="rule">
                        <h5 class="rule-heading">ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã®å›ç­”æ–¹æ³•</h5>
                        <li>ã‚¿ãƒ¼ã‚²ãƒƒãƒˆéŸ³ãŒï¼‘ç•ªç›®ã ã¨æ€ã£ãŸã‚‰Fã‚­ãƒ¼ã€ï¼“ç•ªç›®ã ã¨æ€ã£ãŸã‚‰Jã‚­ãƒ¼ã‚’æŠ¼ã™</li>
                        <li>Spaceã‚­ãƒ¼ã‚’æŠ¼ã—ã¦æ­£èª¤ã‚’ç¢ºèªã—æ¬¡ã®å•é¡Œã«é€²ã‚€</li>
                    </ul>
                    2å›é€£ç¶šã§æ­£è§£ã™ã‚‹ã¨ã€ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã®ã‚ºãƒ¬ã®å¤‰åŒ–ãŒå°‘ãªã„å•é¡Œã«ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ã—ã¾ã™ğŸ’ª<br>
                    é€†ã«1å›ã§ã‚‚é–“é•ãˆã‚‹ã¨ã€ã‚ºãƒ¬ãŒå¤§ãããªã‚‹å•é¡Œã«ãƒ¬ãƒ™ãƒ«ãƒ€ã‚¦ãƒ³ã—ã¾ã™ğŸ˜­
                    <h4>ç·´ç¿’ãŒçµ‚ã‚ã£ãŸã‚‰ãƒšãƒ¼ã‚¸ã®ä¸€ç•ªä¸‹ã®ã€Œæœ¬ç•ªã¸ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦æœ¬ç•ªã«é€²ã¿ã¾ã—ã‚‡ã†ï¼</h4>
                </div>
            </div>
        </div>
        <!-- ãƒ‰ãƒƒãƒˆã¨ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ã‚’ã¾ã¨ã‚ãŸãƒ©ãƒƒãƒ‘ãƒ¼ -->
        <div class="dot-nav-wrapper">
            <button class="slide-nav prev" onclick="prevSlide()">å‰ã¸</button>
            <div class="dots">
                <span class="dot" onclick="goToSlide(0)"></span>
                <span class="dot" onclick="goToSlide(1)"></span>
                <span class="dot" onclick="goToSlide(2)"></span>
                <span class="dot" onclick="goToSlide(3)"></span>
            </div>
            <button class="slide-nav next" onclick="nextSlide()">æ¬¡ã¸</button>
        </div>
    </div>

    <!-- èª¬æ˜æ–‡1 - ãƒ¢ãƒã‚¤ãƒ«ç°¡ç•¥ç‰ˆ -->
    <div id="instructionTopMobile" class="instruction mobile-only">
        <h4>å•é¡Œã®æµã‚Œ</h4>
        <p style="font-size: 13px; margin: 8px 0; line-height: 1.3;">
            3å›éŸ³ã®å¡ŠãŒæµã‚Œã¾ã™ã€‚<br>
            1ç•ªç›®ã‹3ç•ªç›®ã®ã©ã¡ã‚‰ã‹ãŒ<span class="target-text">ã‚¿ãƒ¼ã‚²ãƒƒãƒˆéŸ³</span>ã§ã™ã€‚<br>
            éŸ³ã®é•ã„ã‚’èãå–ã£ã¦é¸æŠã—ã¦ãã ã•ã„ï¼<br>
        </p>
        <div style="display: flex; justify-content: space-around; margin: 10px 0;">
            <div style="text-align: center;">
                <p style="margin: 5px 0; font-size: 12px;">ãƒãƒ¼ãƒãƒ«éŸ³</p>
                <audio id="sample_audio_normal_mobile"
                    src="{{ url_for('static', filename='stimuli/' + ('piano_successive_0.52*4' if session['sound_type'] == 'piano' else 'successive_0.52*4') + '/as_semitone/' + ('piano_gallops_' if session['sound_type'] == 'piano' else 'gallops_') + '0.00ms.wav') }}"></audio>
                <button class="play-button" onclick="playAudio('sample_audio_normal_mobile')"
                    style="width: 35px; height: 35px;"></button>
            </div>

            <div style="text-align: center;">
                <p style="margin: 5px 0; font-size: 12px;"><span class="target-text">ã‚¿ãƒ¼ã‚²ãƒƒãƒˆéŸ³</span></p>
                <audio id="sample_audio_target_mobile"
                    src="{{ url_for('static', filename='stimuli/' + ('piano_successive_0.52*4' if session['sound_type'] == 'piano' else 'successive_0.52*4') + '/as_semitone/' + ('piano_gallops_' if session['sound_type'] == 'piano' else 'gallops_') + '64.00ms.wav') }}"></audio>
                <button class="play-button target-button" onclick="playAudio('sample_audio_target_mobile')"
                    style="width: 35px; height: 35px;"></button>
            </div>
        </div>

        <p style="font-size: 13px; margin: 8px 0; line-height: 1.3;">
            æ­£èª¤ã«å¿œã˜ã¦å•é¡Œã®é›£æ˜“åº¦ãŒå¤‰ã‚ã‚Šã¾ã™ğŸ’ª
        </p>
    </div>

    <!-- éŸ³æ¡ä»¶é¸æŠ -->
    <div class="container">
        <h2>ç·´ç¿’å•é¡Œ</h2>
        <div class="dropdown-container">
            <select id="frequencyDirSelect">
                {% for freq in session['frequency_dirs'] %}
                <option value="{{ freq }}">{{ frequency_labels.get(freq, freq) }}</option>
                {% endfor %}
            </select>
            <button id="startPracticeBtn" class="button" onclick="startPracticeTrial()">å•é¡Œã‚’å†ç”Ÿ</button>
        </div>

        <!-- ãƒˆãƒ©ã‚¤ã‚¢ãƒ«ã‚¨ãƒªã‚¢ -->
        <div id="trialArea" class="trial-container">
            <!-- é¸æŠãƒœã‚¿ãƒ³ -->
            <p class="pc-only">ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãŒ1ç•ªç›®ãªã‚‰Fã‚­ãƒ¼ã€3ç•ªç›®ãªã‚‰Jã‚­ãƒ¼ã§é¸æŠã—spaceã‚­ãƒ¼ã§é€ä¿¡</p>
            <p class="mobile-only">ã‚¿ãƒ¼ã‚²ãƒƒãƒˆéŸ³ã¯ã©ã£ã¡ï¼Ÿ</p>
            <div class="button-container">
                <button id="buttonF" class="button"><span class="pc-only">1st(F)</span><span
                        class="mobile-only">1st</span></button>
                <button id="buttonJ" class="button"><span class="pc-only">3rd(J)</span><span
                        class="mobile-only">3rd</span></button>
            </div>
            <div class="button-container submit-container">
                <button id="buttonSubmit" class="button submit-button"><span class="pc-only">é€ä¿¡(Space)</span><span
                        class="mobile-only">æ±ºå®š</span></button>
            </div>
            <!-- ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
            <div id="error"></div>

            <!-- çµæœè¡¨ç¤º -->
            <h3 id="resultText"></h3>
            <div id="resultImage"></div>
            <!-- ã‚‚ã†ä¸€åº¦èããƒœã‚¿ãƒ³ï¼ˆåˆæœŸã¯éè¡¨ç¤ºã€‚é€ä¿¡å¾Œã«è¡¨ç¤ºï¼‰ -->
            <button id="replayTrialBtn" class="button" onclick="replayTrial()" style="display: none;">ã‚‚ã†ä¸€åº¦èã</button>

        </div>
    </div>

    <!-- å®Ÿé¨“ã¸é€²ã‚€ãƒœã‚¿ãƒ³ -->
    <!-- èª¬æ˜æ–‡2 -->
    <div id="instructionStart" class="instruction-start">
        <h3>âš ï¸ã©ã®æ¡ä»¶ã§ã‚‚èãå–ã‚Šã‚„ã™ã„éŸ³é‡ã«èª¿æ•´ã—ã¦ãã ã•ã„</h3>
        <p>éŸ³é‡ã¯å¤‰ãˆãšã«å®Ÿé¨“ã«å–ã‚Šçµ„ã‚“ã§ãã ã•ã„ğŸ™‡ğŸ»â€â™‚ï¸</p>
    </div>

    <!-- é–‹å§‹ãƒœã‚¿ãƒ³ -->
    <button id="finishPractice" onclick="finishPractice()">æœ¬ç•ªã¸</button>

    <script>
        let selectedKey = null; // é¸æŠã—ãŸã‚­ãƒ¼ã‚’è¨˜éŒ²ã™ã‚‹å¤‰æ•°
        let isTrialRunning = false;
        let isAudioPlaying = false;
        let practiceTarget = null;  // ç·´ç¿’å•é¡Œã®ã‚¿ãƒ¼ã‚²ãƒƒãƒˆéŸ³ï¼ˆf or jï¼‰
        let currentTonePaths = null;  // ç¾åœ¨å†ç”Ÿä¸­ã®éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹

        function playAudio(id) {
            const audio = document.getElementById(id);
            audio.play();
        }

        // ãƒœã‚¿ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯/ã‚¿ãƒƒãƒ—ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
        document.getElementById("buttonF").addEventListener("click", function () {
            selectKey("f");
        });

        document.getElementById("buttonJ").addEventListener("click", function () {
            selectKey("j");
        });

        document.getElementById("buttonSubmit").addEventListener("click", function () {
            // ã‚¹ãƒšãƒ¼ã‚¹ã‚­ãƒ¼ã¨åŒã˜æ©Ÿèƒ½ã‚’å®Ÿè¡Œ
            if (!isTrialRunning) {
                document.getElementById("error").innerText = "å•é¡ŒãŒå†ç”Ÿã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚å†ç”Ÿãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚";
                return;
            }

            if (isAudioPlaying) {
                document.getElementById("error").innerText = "éŸ³å£°å†ç”Ÿä¸­ã§ã™ã€‚ã™ã¹ã¦ã®éŸ³ãŒå†ç”Ÿã•ã‚ŒãŸå¾Œã§å¿œç­”ã—ã¦ãã ã•ã„ã€‚";
                setTimeout(() => {
                    document.getElementById("error").innerText = "";
                }, 1000);
                return;
            }

            if (!selectedKey) {
                document.getElementById("error").innerText = "Fã‚­ãƒ¼ã¾ãŸã¯Jã‚­ãƒ¼ã‚’é¸æŠã—ã¦ãã ã•ã„ï¼";
                setTimeout(() => {
                    document.getElementById("error").innerText = "";
                }, 1000);
                return;
            }

            // æ­£èª¤åˆ¤å®šã¨çµæœè¡¨ç¤º
            const resultText = document.getElementById("resultText");
            const resultImage = document.getElementById("resultImage");
            const replayBtn = document.getElementById("replayTrialBtn");

            if (selectedKey === practiceTarget) {
                if (practiceTarget === "f") {
                    resultText.innerText = "æ­£è§£ã§ã™ğŸ”¥ï¼‘ç•ªç›®ãŒã‚¿ãƒ¼ã‚²ãƒƒãƒˆã§ã—ãŸ";
                    resultImage.innerHTML = "<img src='static/sample_fig/trial_target_first.png' class='result-img'>";
                } else if (practiceTarget === "j") {
                    resultText.innerText = "æ­£è§£ã§ã™ğŸ”¥ï¼“ç•ªç›®ãŒã‚¿ãƒ¼ã‚²ãƒƒãƒˆã§ã—ãŸ";
                    resultImage.innerHTML = "<img src='static/sample_fig/trial_target_third.png' class='result-img'>";
                }
            } else {
                if (practiceTarget === "f") {
                    resultText.innerText = "ä¸æ­£è§£ã§ã™ğŸ’¦ï¼‘ç•ªç›®ãŒã‚¿ãƒ¼ã‚²ãƒƒãƒˆã§ã—ãŸ";
                    resultImage.innerHTML = "<img src='static/sample_fig/trial_target_first.png' class='result-img'>";
                } else if (practiceTarget === "j") {
                    resultText.innerText = "ä¸æ­£è§£ã§ã™ğŸ’¦ï¼“ç•ªç›®ãŒã‚¿ãƒ¼ã‚²ãƒƒãƒˆã§ã—ãŸ";
                    resultImage.innerHTML = "<img src='static/sample_fig/trial_target_third.png' class='result-img'>";
                }
            }

            // ã‚¨ãƒ©ãƒ¼è¡¨ç¤ºã‚’ã‚¯ãƒªã‚¢
            document.getElementById("error").innerText = "";
            // ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã¨åŒæ™‚ã«å†ç”Ÿãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º
            if (replayBtn) replayBtn.style.display = "block";
            selectedKey = null;
        });

        // ã‚­ãƒ¼å…¥åŠ›ã®ãƒªã‚¹ãƒŠãƒ¼
        document.addEventListener("keydown", (event) => {
            const errorElement = document.getElementById("error");
            const resultText = document.getElementById("resultText");
            const resultImage = document.getElementById("resultImage");
            const replayBtn = document.getElementById("replayTrialBtn");

            if (event.code === "KeyF") {
                selectKey("f");
            } else if (event.code === "KeyJ") {
                selectKey("j");
            } else if (event.code === "Space") {
                event.preventDefault();
                // éŸ³å£°å†ç”Ÿä¸­ã®ã‚¨ãƒ©ãƒ¼ãƒã‚§ãƒƒã‚¯ã‚’æœ€å„ªå…ˆ
                if (!isTrialRunning) {
                    errorElement.innerText = "å•é¡ŒãŒå†ç”Ÿã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚å†ç”Ÿãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚";
                    return;
                }
                if (isAudioPlaying) {
                    errorElement.innerText = "éŸ³å£°å†ç”Ÿä¸­ã§ã™ã€‚ã™ã¹ã¦ã®éŸ³ãŒå†ç”Ÿã•ã‚ŒãŸå¾Œã§å¿œç­”ã—ã¦ãã ã•ã„ã€‚";
                    setTimeout(() => {
                        errorElement.innerText = "";
                    }, 1000);
                    return;
                }

                // é¸æŠã•ã‚Œã¦ã„ãªã„å ´åˆã®ã‚¨ãƒ©ãƒ¼ãƒã‚§ãƒƒã‚¯
                if (!selectedKey) {
                    errorElement.innerText = "Fã‚­ãƒ¼ã¾ãŸã¯Jã‚­ãƒ¼ã‚’é¸æŠã—ã¦ãã ã•ã„ï¼";
                    setTimeout(() => {
                        errorElement.innerText = "";
                    }, 1000);
                    return;
                }

                if (selectedKey === practiceTarget) {
                    if (practiceTarget === "f") {
                        resultText.innerText = "æ­£è§£ã§ã™ğŸ”¥ï¼‘ç•ªç›®ãŒã‚¿ãƒ¼ã‚²ãƒƒãƒˆã§ã—ãŸ";
                        resultImage.innerHTML = "<img src='static/sample_fig/trial_target_first.png' class='result-img'>";
                    } else if (practiceTarget === "j") {
                        resultText.innerText = "æ­£è§£ã§ã™ğŸ”¥ï¼“ç•ªç›®ãŒã‚¿ãƒ¼ã‚²ãƒƒãƒˆã§ã—ãŸ";
                        resultImage.innerHTML = "<img src='static/sample_fig/trial_target_third.png' class='result-img'>";
                    }
                } else {
                    if (practiceTarget === "f") {
                        resultText.innerText = "ä¸æ­£è§£ã§ã™ğŸ’¦ï¼‘ç•ªç›®ãŒã‚¿ãƒ¼ã‚²ãƒƒãƒˆã§ã—ãŸ";
                        resultImage.innerHTML = "<img src='static/sample_fig/trial_target_first.png' class='result-img'>";
                    } else if (practiceTarget === "j") {
                        resultText.innerText = "ä¸æ­£è§£ã§ã™ğŸ’¦ï¼“ç•ªç›®ãŒã‚¿ãƒ¼ã‚²ãƒƒãƒˆã§ã—ãŸ";
                        resultImage.innerHTML = "<img src='static/sample_fig/trial_target_third.png' class='result-img'>";
                    }
                }

                // ã‚¨ãƒ©ãƒ¼è¡¨ç¤ºã‚’ã‚¯ãƒªã‚¢ï¼ˆæ­£è§£/ä¸æ­£è§£ã«é–¢ã‚ã‚‰ãšï¼‰
                errorElement.innerText = "";
                // ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã¨åŒæ™‚ã«å†ç”Ÿãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º
                if (replayBtn) replayBtn.style.display = "block";
                selectedKey = null;
            }
        });

        document.addEventListener("DOMContentLoaded", () => {
            // æ—¢å­˜ã®åˆæœŸåŒ–å‡¦ç†
            updateDots();

            // ç·´ç¿’å•é¡Œå†ç”Ÿãƒœã‚¿ãƒ³ã®ã‚¹ãƒšãƒ¼ã‚¹ã‚­ãƒ¼æŠ¼ä¸‹ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã™ã‚‹
            const startBtn = document.getElementById("startPracticeBtn");
            const replayBtn = document.getElementById("replayTrialBtn");
            if (startBtn) {
                startBtn.addEventListener("keydown", (event) => {
                    if (event.code === "Space") {
                        event.preventDefault();
                    }
                });
            }
            if (replayBtn) {
                replayBtn.addEventListener("keydown", (event) => {
                    if (event.code === "Space") {
                        event.preventDefault();
                    }
                });
            }
        });


        // ã‚­ãƒ¼é¸æŠå‡¦ç†
        function selectKey(key) {
            selectedKey = key;

            // é¸æŠçŠ¶æ…‹ã‚’è¦–è¦šçš„ã«è¡¨ç¤º
            document.getElementById("buttonF").classList.remove("selected");
            document.getElementById("buttonJ").classList.remove("selected");

            if (key === "f") {
                document.getElementById("buttonF").classList.add("selected");
            } else if (key === "j") {
                document.getElementById("buttonJ").classList.add("selected");
            }

            // ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ã‚¯ãƒªã‚¢
            document.getElementById("error").innerText = "";
        }

        // ã‚¹ãƒ©ã‚¤ãƒ‰å‡¦ç†
        let currentSlide = 0;

        function updateSlidePosition() {
            const sliderWrapper = document.querySelector('.slider-wrapper');
            sliderWrapper.style.transform = 'translateX(' + (-currentSlide * 100) + '%)';
            updateDots(); // ã‚¹ãƒ©ã‚¤ãƒ‰ä½ç½®æ›´æ–°æ™‚ã«ãƒ‰ãƒƒãƒˆã‚‚æ›´æ–°
        }

        function nextSlide() {
            const slides = document.querySelectorAll('.slide');
            if (currentSlide < slides.length - 1) {
                currentSlide++;
                updateSlidePosition();
            }
        }

        function prevSlide() {
            if (currentSlide > 0) {
                currentSlide--;
                updateSlidePosition();
            }
        }

        function goToSlide(index) {
            currentSlide = index;
            updateSlidePosition();
        }

        function updateDots() {
            const dots = document.querySelectorAll('.dot');
            dots.forEach((dot, index) => {
                if (index === currentSlide) {
                    dot.classList.add('active');
                } else {
                    dot.classList.remove('active');
                }
            });
        }

        // åˆæœŸçŠ¶æ…‹ã®ãƒ‰ãƒƒãƒˆã‚’æ›´æ–°
        document.addEventListener("DOMContentLoaded", updateDots);

        // ç·´ç¿’ãƒˆãƒ©ã‚¤ã‚¢ãƒ«é–‹å§‹å‡¦ç†
        function startPracticeTrial() {
            console.log("startPracticeTrial");
            const freqSelect = document.getElementById("frequencyDirSelect");
            const frequencyDir = freqSelect.value;  // ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ã‹ã‚‰é¸æŠã•ã‚ŒãŸå‘¨æ³¢æ•°æ¡ä»¶ï¼ˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªåï¼‰
            const soundType = "{{ session['sound_type'] }}";

            // éŸ³ã®ç¨®é¡ã«å¿œã˜ã¦ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¨ãƒ•ã‚¡ã‚¤ãƒ«åãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã‚’æ±ºå®š
            const audioDir = soundType === 'piano' ? 'piano_successive_0.52*4' : 'successive_0.52*4';
            const filePrefix = soundType === 'piano' ? 'piano_gallops_' : 'gallops_';
            document.getElementById("trialArea").style.display = "block";
            document.getElementById("resultText").innerText = "";
            document.getElementById("resultImage").innerHTML = "";
            // æ–°ã—ã„å•é¡Œãªã®ã§ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯é–¢é€£ã‚’éè¡¨ç¤º
            const replayBtn = document.getElementById("replayTrialBtn");
            if (replayBtn) replayBtn.style.display = "none";

            // ãƒ©ãƒ³ãƒ€ãƒ ã« tone1 ã¾ãŸã¯ tone3 ã‚’ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã«ã™ã‚‹
            let targetPosition = Math.random() < 0.5 ? 1 : 3;
            practiceTarget = (targetPosition === 1) ? "f" : "j";

            // tone2 ã¯å¸¸ã«é€šå¸¸éŸ³ (offset 0.00ms)
            // tone1 ã¨ tone3 ã¯ã€ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãªã‚‰ offset 64.00msã€ãã†ã§ãªã‘ã‚Œã° 0.00ms ã®éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«
            let tone1Path, tone2Path, tone3Path;
            if (targetPosition === 1) {
                // tone1 ãŒã‚¿ãƒ¼ã‚²ãƒƒãƒˆ
                tone1Path = `/static/stimuli/${audioDir}/${frequencyDir}/${filePrefix}64.00ms.wav`;
                tone2Path = `/static/stimuli/${audioDir}/${frequencyDir}/${filePrefix}0.00ms.wav`;
                tone3Path = `/static/stimuli/${audioDir}/${frequencyDir}/${filePrefix}0.00ms.wav`;
            } else {
                // tone3 ãŒã‚¿ãƒ¼ã‚²ãƒƒãƒˆ
                tone1Path = `/static/stimuli/${audioDir}/${frequencyDir}/${filePrefix}0.00ms.wav`;
                tone2Path = `/static/stimuli/${audioDir}/${frequencyDir}/${filePrefix}0.00ms.wav`;
                tone3Path = `/static/stimuli/${audioDir}/${frequencyDir}/${filePrefix}64.00ms.wav`;
            }

            currentTonePaths = { tone1: tone1Path, tone2: tone2Path, tone3: tone3Path };

            isTrialRunning = true;
            isAudioPlaying = true;

            // å„éŸ³å£°ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ç”Ÿæˆã—ã€é †ã«å†ç”Ÿ
            const audio1 = new Audio(tone1Path);
            const audio2 = new Audio(tone2Path);
            const audio3 = new Audio(tone3Path);

            audio1.play();
            audio1.onended = () => {
                setTimeout(() => {
                    audio2.play();
                    audio2.onended = () => {
                        setTimeout(() => {
                            audio3.play();
                            audio3.onended = () => {
                                isAudioPlaying = false;  // å…¨ã¦å†ç”Ÿå®Œäº†
                            };
                        }, 500);
                    };
                }, 500);
            };
        }

        function replayTrial() {
            if (!currentTonePaths) return;  // ã¾ã ä¿å­˜ã•ã‚Œã¦ã„ãªã„å ´åˆã¯ä½•ã‚‚ã—ãªã„
            if (isAudioPlaying) return;  // å†ç”Ÿä¸­ã¯ä½•ã‚‚ã—ãªã„
            isTrialRunning = true;
            isAudioPlaying = true;

            const audio1 = new Audio(currentTonePaths.tone1);
            const audio2 = new Audio(currentTonePaths.tone2);
            const audio3 = new Audio(currentTonePaths.tone3);

            audio1.play();
            audio1.onended = () => {
                setTimeout(() => {
                    audio2.play();
                    audio2.onended = () => {
                        setTimeout(() => {
                            audio3.play();
                            audio3.onended = () => {
                                isAudioPlaying = false;
                            };
                        }, 500);
                    };
                }, 500);
            };
        }

        function playSlide2Trial() {
            // frequencyDirã¯å›ºå®šã§ "as_semitone"
            const soundType = "{{ session['sound_type'] }}";
            const audioDir = soundType === 'piano' ? 'piano_successive_0.52*4' : 'successive_0.52*4';
            const filePrefix = soundType === 'piano' ? 'piano_gallops_' : 'gallops_';

            // ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã‚’å›ºå®šå€¤ã§ç”Ÿæˆï¼ˆå¿…è¦ã«å¿œã˜ã¦ã€ãƒ‘ã‚¹å†…ã®ç‰¹æ®Šæ–‡å­—ã®æ‰±ã„ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼‰
            const tone1Path = `/static/stimuli/${audioDir}/as_semitone/${filePrefix}0.00ms.wav`;
            const tone2Path = `/static/stimuli/${audioDir}/as_semitone/${filePrefix}0.00ms.wav`;
            const tone3Path = `/static/stimuli/${audioDir}/as_semitone/${filePrefix}64.00ms.wav`;

            // å„éŸ³å£°ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ç”Ÿæˆ
            const audio1 = new Audio(tone1Path);
            const audio2 = new Audio(tone2Path);
            const audio3 = new Audio(tone3Path);

            audio1.play().catch((e) => console.error("audio1 play error:", e));
            audio1.onended = () => {
                setTimeout(() => {
                    audio2.play().catch((e) => console.error("audio2 play error:", e));
                    audio2.onended = () => {
                        setTimeout(() => {
                            audio3.play().catch((e) => console.error("audio3 play error:", e));
                            audio3.onended = () => {
                            };
                        }, 500);
                    };
                }, 500);
            };
        }

        // /experimentã¸é€²ã‚€
        function finishPractice() {
            window.location.href = "/experiment";
        }
    </script>
</body>

</html>
