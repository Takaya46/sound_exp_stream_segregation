<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>å®Ÿé¨“</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <style>
        .trial-example {
            display: flex;
            justify-content: center;
            align-items: center;
        }
                /* ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã‚³ãƒ³ãƒ†ãƒŠ */
        .slider-container {
        position: relative;
        overflow: hidden;
        width: 100%;
        max-width: 700px;
        margin: 0 auto;
        }

        /* æ¨ªä¸¦ã³ã«ã™ã‚‹ãƒ©ãƒƒãƒ‘ãƒ¼ */
        .slider-wrapper {
        display: flex;
        transition: transform 0.5s ease-in-out;
        }

        /* å„ã‚¹ãƒ©ã‚¤ãƒ‰ */
        .slide {
        flex: 0 0 100%;
        box-sizing: border-box;
        padding: 20px;
        }

        .rule {
            padding: 15px;
            background-color: gainsboro;
            border: 2px solid #333;
            border-radius: 10px;
            box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.2);  /* å½±ã‚’è¿½åŠ  */
        }
        /* ãƒ‰ãƒƒãƒˆã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ */
        .dots {
        text-align: center;
        }

        .dot {
        height: 12px;
        width: 12px;
        margin: 0 5px;
        background-color: #bbb;
        border-radius: 50%;
        display: inline-block;
        cursor: pointer;
        transition: background-color 0.3s ease;
        }

        .dot.active {
        background-color: #717171;
        }

        /* ãƒ‰ãƒƒãƒˆã¨ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ã‚’ã¾ã¨ã‚ã‚‹ãƒ©ãƒƒãƒ‘ãƒ¼ */
        .dot-nav-wrapper {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
        }

        .dot-nav-wrapper .slide-nav {
            background-color: rgba(0, 0, 0, 0.5);
            color: #fff;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            margin: 0 10px;
        }

        .dropdown-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 20px;
        }

        #startPracticeBtn {
            width: 150px;
            padding: 0;
        }

        #replayTrialBtn {
            display: block;
            background-color: gray;
            width: 150px;
            padding: 0;
            margin: 20px auto;
        }

        #finishPractice {
            display: block;
            background-color: #4CAF50;
            color: white;
            padding: 14px 20px;
            margin: 20px auto;
            margin-bottom: 100px;
            border: none;
            cursor: pointer;
            width: 200px;
        }
    </style>
</head>
<body>
    <h1></h1>
    <!-- éŸ³å£°è¦ç´  -->
    <audio id="tone1" preload="auto"></audio>
    <audio id="tone2" preload="auto"></audio>
    <audio id="tone3" preload="auto"></audio>

    <!-- èª¬æ˜æ–‡1 -->
    <div id="instructionTop" class="instruction">
        <h3>ã‚¯ã‚¤ã‚ºã®èª¬æ˜ (ä¾‹: éŸ³æ¡ä»¶ï¼’)</h3>
        <div class="slider-container">
            <div class="slider-wrapper">
                <!-- ã‚¹ãƒ©ã‚¤ãƒ‰1 -->
                <div class="slide">
                    <p>ã€Œã‚¿ã‚¿ã‚¿ã€ãŒï¼”å›é€£ç¶šã—ãŸã‚‚ã®ã‚’ï¼‘ã¤ã®éŸ³ã¨ã—ã¾ã™</p>
                    <div class="media-container">
                        <audio id="sample_audio_normal" src="{{ url_for('static', filename='stimuli/successive_0.52*4/as_semitone/gallops_0.00ms.wav') }}"></audio>
                        <button class="play-button" onclick="playAudio('sample_audio_normal')"></button>
                        <img src="{{ url_for('static', filename='sample_fig/stimuli_normal.png') }}" style="height: 70px;">
                    </div>
                    <p>ã“ã®éŸ³ã‚’ãƒãƒ¼ãƒãƒ«éŸ³ã¨ã—ã¾ã™</p>
                </div>
                <!-- ã‚¹ãƒ©ã‚¤ãƒ‰2 -->
                <div class="slide">
                    <p>ã“ã®éŸ³ãŒé–“ã‚’é–‹ã‘ã¦ã€3å›æµã‚Œã¾ã™</p>
                    <div class="trial-example">
                        <button class="play-button" onclick="playSlide2Trial()"></button>
                        <img src="{{ url_for('static', filename='sample_fig/trial_target_third.png') }}" style="height: 100px;">
                    </div>
                    <p>ãƒãƒ¼ãƒãƒ«éŸ³ã€ãƒãƒ¼ãƒãƒ«éŸ³ã€ãƒãƒ¼ãƒãƒ«éŸ³ï¼Ÿ<br>3ã¤ç›®ã®éŸ³ã¯ãƒªã‚ºãƒ ãŒé•ã„ã¾ã™ã­ï¼
                    </p>
                </div>
                <!-- ã‚¹ãƒ©ã‚¤ãƒ‰3 -->
                <div class="slide">     
                    <p>ã“ã®ã‚ˆã†ã«ãƒªã‚ºãƒ ã®å´©ã‚ŒãŸéŸ³ã‚’<span style="color: red;">ã‚¿ãƒ¼ã‚²ãƒƒãƒˆéŸ³</span>ã¨ã—ã¾ã™</p>
                    <h4>çš†ã•ã‚“ã«ã¯ã“ã®<span style="color: red;">ã‚¿ãƒ¼ã‚²ãƒƒãƒˆéŸ³</span>ã‚’å½“ã¦ã‚‹å•é¡Œã«æŒ‘æˆ¦ã—ã¦ã‚‚ã‚‰ã„ã¾ã™ï¼ï¼</h4>
                    <p>å®Ÿéš›ã®å•é¡Œã®ãƒ«ãƒ¼ãƒ«ã¯æ¬¡ã®ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™</p>
                    <ul class="rule">
                        <h5 style="margin-block-start: 0; margin-block-end: 10px;">å•é¡Œã®ãƒ«ãƒ¼ãƒ«</h5>
                        <li>ï¼“å›éŸ³ãŒæµã‚Œã¾ã™</li>
                        <li>ï¼‘ç•ªç›®ã‹ï¼“ç•ªç›®ã®ã©ã¡ã‚‰ã‹ä¸€æ–¹ãŒã‚¿ãƒ¼ã‚²ãƒƒãƒˆéŸ³ã§ã™</li>
                        <li>ï¼’ç•ªç›®ã¯å¿…ãšãƒãƒ¼ãƒãƒ«éŸ³ã§ã™</li>
                        <li>ã‚¿ãƒ¼ã‚²ãƒƒãƒˆéŸ³ã¯ã€é«˜ã„éŸ³ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ãŒå¾Œã‚ã«ãšã‚ŒãŸéŸ³ã§ã€Œã‚¿ãƒƒã‚¿ã‚¿ã€ã¨ã„ã†ãƒªã‚ºãƒ ã«ãªã‚Šã¾ã™ï¼ˆâ€»éŸ³æ¡ä»¶ï¼‘ã§ã¯ã‚ºãƒ¬ã‚‹éŸ³ã®é«˜ã•ã¯å‘¨ã‚Šã¨åŒã˜ã§ã™ï¼‰
                            <div class="media-container" style="margin-top: 20px;">
                                <audio id="sample_audio_target" src="{{ url_for('static', filename='stimuli/successive_0.52*4/as_semitone/gallops_64.00ms.wav') }}"></audio>
                                <button class="play-button" onclick="playAudio('sample_audio_target')" style="margin-bottom: 20px;"></button>
                                <img src="{{ url_for('static', filename='sample_fig/stimuli_target_v3.png') }}" style="height: 70px; margin-bottom: 20px;">
                            </div>
                        </li>            
                    </ul>
                    
                </div>
                <!-- ã‚¹ãƒ©ã‚¤ãƒ‰4 -->
                <div class="slide">
                    <h4>ç·´ç¿’å•é¡Œã«ä¸‹ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§å–ã‚Šçµ„ã‚“ã§ã¿ã¦ãã ã•ã„ï¼</h4>
                    <ul class="rule">
                        <h5 style="margin-block-start: 0; margin-block-end: 10px;">ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã®å›ç­”æ–¹æ³•</h5>
                        <li>ã‚¿ãƒ¼ã‚²ãƒƒãƒˆéŸ³ãŒï¼‘ç•ªç›®ã ã¨æ€ã£ãŸã‚‰Fã‚­ãƒ¼ã€ï¼“ç•ªç›®ã ã¨æ€ã£ãŸã‚‰Jã‚­ãƒ¼ã‚’æŠ¼ã™</li>
                        <li>Spaceã‚­ãƒ¼ã‚’æŠ¼ã—ã¦æ­£èª¤ã‚’ç¢ºèªã—æ¬¡ã®å•é¡Œã«é€²ã‚€</li>
                    </ul>
                    2å›é€£ç¶šã§æ­£è§£ã™ã‚‹ã¨ã€ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã®ã‚ºãƒ¬ã®å¤‰åŒ–ãŒå°‘ãªã„å•é¡Œã«ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ã—ã¾ã™ğŸ’ª<br>
                    é€†ã«1å›ã§ã‚‚é–“é•ãˆã‚‹ã¨ã€ã‚ºãƒ¬ãŒå¤§ãããªã‚‹å•é¡Œã«ãƒ¬ãƒ™ãƒ«ãƒ€ã‚¦ãƒ³ã—ã¾ã™ğŸ˜­
                    <h4>ç·´ç¿’ãŒçµ‚ã‚ã£ãŸã‚‰ãƒšãƒ¼ã‚¸ã®ä¸€ç•ªä¸‹ã®ã€Œæœ¬ç•ªã¸ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦æœ¬ç•ªã«é€²ã¿ã¾ã—ã‚‡ã†ï¼</h4>
                </div>
            </div>
        </div>
        <!-- ãƒ‰ãƒƒãƒˆã¨ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ã‚’ã¾ã¨ã‚ãŸãƒ©ãƒƒãƒ‘ãƒ¼ -->
        <div class="dot-nav-wrapper">
            <button class="slide-nav prev" onclick="prevSlide()">å‰ã¸</button>
            <div class="dots">
                <span class="dot" onclick="goToSlide(0)"></span>
                <span class="dot" onclick="goToSlide(1)"></span>
                <span class="dot" onclick="goToSlide(2)"></span>
                <span class="dot" onclick="goToSlide(3)"></span>
            </div>
            <button class="slide-nav next" onclick="nextSlide()">æ¬¡ã¸</button>
        </div>
    </div>

    <!-- éŸ³æ¡ä»¶é¸æŠ -->
    <div class="container">
        <h2>ç·´ç¿’å•é¡Œ</h2>
        
        <p>éŸ³æ¡ä»¶ã‚’é¸æŠã—ã€Œå•é¡Œã‚’å†ç”Ÿã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨å•é¡ŒãŒå†ç”Ÿã•ã‚Œã¾ã™</p>
        <div class="dropdown-container">
            <select id="frequencyDirSelect">
                {% for freq in session['frequency_dirs'] %}
                    <option value="{{ freq }}">{{ frequency_labels.get(freq, freq) }}</option>
                {% endfor %}
            </select>
            <button id="startPracticeBtn" class="button" onclick="startPracticeTrial()">å•é¡Œã‚’å†ç”Ÿ</button>
        </div>
    
        <!-- ãƒˆãƒ©ã‚¤ã‚¢ãƒ«ã‚¨ãƒªã‚¢ -->
        <div id="trialArea" class="trial-container">
            <!-- é¸æŠãƒœã‚¿ãƒ³ -->
            <p class="pc-only">ã‚¿ãƒ¼ã‚²ãƒƒãƒˆéŸ³ãŒ1ç•ªç›®ãªã‚‰Fã‚­ãƒ¼ã€3ç•ªç›®ãªã‚‰Jã‚­ãƒ¼ã‚’æŠ¼ã—ã¦ãã ã•ã„</p>
            <p class="mobile-only">ã‚¿ãƒ¼ã‚²ãƒƒãƒˆéŸ³ãŒ1ç•ªç›®ã‹3ç•ªç›®ã‹ã‚’é¸ã‚“ã§ãã ã•ã„</p>
            <div class="button-container">
                <button id="buttonF" class="button"><span class="pc-only">1st(F)</span><span class="mobile-only">1ç•ªç›®</span></button>
                <button id="buttonJ" class="button"><span class="pc-only">3rd(J)</span><span class="mobile-only">3ç•ªç›®</span></button>
            </div>
            <div class="button-container submit-container">
                <button id="buttonSubmit" class="button submit-button"><span class="pc-only">é€ä¿¡(Space)</span><span class="mobile-only">é€ä¿¡</span></button>
            </div>
            <p class="pc-only">Spaceã‚­ãƒ¼ã‚’æŠ¼ã™ã¨æ­£èª¤ãŒè¡¨ç¤ºã•ã‚Œã¾ã™!<br>ï¼ˆæœ¬ç•ªã§ã¯ãã®ã¾ã¾æ¬¡ã®å•é¡Œã«é€²ã¿ã¾ã™ï¼‰</p>
            <p class="mobile-only">é€ä¿¡ãƒœã‚¿ãƒ³ã‚’ã‚¿ãƒƒãƒ—ã™ã‚‹ã¨æ­£èª¤ãŒè¡¨ç¤ºã•ã‚Œã¾ã™</p>
            <!-- ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
            <div id="error" style="color: red; margin-top: 20px; font-size: 16px;"></div>

            <!-- çµæœè¡¨ç¤º -->
            <h3 id="resultText"></h3>
            <div id="resultImage"></div>

            <p>â€»æœ¬ç•ªã¯å›³ã«ã‚ˆã‚‹ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã¯ã‚ã‚Šã¾ã›ã‚“</p>
            <!-- ã‚‚ã†ä¸€åº¦èããƒœã‚¿ãƒ³ -->
            <button id="replayTrialBtn" class="button" onclick="replayTrial()">ã‚‚ã†ä¸€åº¦èã</button>
            
        </div>
    </div>

    <!-- å®Ÿé¨“ã¸é€²ã‚€ãƒœã‚¿ãƒ³ -->
    <!-- èª¬æ˜æ–‡2 -->
    <div id="instructionStart" class="instruction-start">
        <h3>âš ï¸ã©ã®æ¡ä»¶ã§ã‚‚èãå–ã‚Šã‚„ã™ã„éŸ³é‡ã«èª¿æ•´ã—ã¦ãã ã•ã„</h3>
        <p>ã“ã‚Œä»¥é™ã¯éŸ³é‡ã¯å¤‰ãˆãšã«å®Ÿé¨“ã«å–ã‚Šçµ„ã‚“ã§ãã ã•ã„ğŸ™‡ğŸ»â€â™‚ï¸</p>
    </div>

    <!-- é–‹å§‹ãƒœã‚¿ãƒ³ -->
    <button id="finishPractice" onclick="finishPractice()">æœ¬ç•ªã¸</button>

    <script>
        let selectedKey = null; // é¸æŠã—ãŸã‚­ãƒ¼ã‚’è¨˜éŒ²ã™ã‚‹å¤‰æ•°
        let isTrialRunning = false;
        let isAudioPlaying = false;
        let practiceTarget = null;  // ç·´ç¿’å•é¡Œã®ã‚¿ãƒ¼ã‚²ãƒƒãƒˆéŸ³ï¼ˆf or jï¼‰
        let currentTonePaths = null;  // ç¾åœ¨å†ç”Ÿä¸­ã®éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹

        function playAudio(id) {
            const audio = document.getElementById(id);
            audio.play();
        }
        
        // ãƒœã‚¿ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯/ã‚¿ãƒƒãƒ—ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
        document.getElementById("buttonF").addEventListener("click", function() {
            selectKey("f");
        });
        
        document.getElementById("buttonJ").addEventListener("click", function() {
            selectKey("j");
        });
        
        document.getElementById("buttonSubmit").addEventListener("click", function() {
            // ã‚¹ãƒšãƒ¼ã‚¹ã‚­ãƒ¼ã¨åŒã˜æ©Ÿèƒ½ã‚’å®Ÿè¡Œ
            if (!isTrialRunning) {
                document.getElementById("error").innerText = "å•é¡ŒãŒå†ç”Ÿã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚å†ç”Ÿãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚";
                return;
            }
            
            if (isAudioPlaying) {
                document.getElementById("error").innerText = "éŸ³å£°å†ç”Ÿä¸­ã§ã™ã€‚ã™ã¹ã¦ã®éŸ³ãŒå†ç”Ÿã•ã‚ŒãŸå¾Œã§å¿œç­”ã—ã¦ãã ã•ã„ã€‚";
                setTimeout(() => {
                    document.getElementById("error").innerText = "";
                }, 1000);
                return;
            }
            
            if (!selectedKey) {
                document.getElementById("error").innerText = "Fã‚­ãƒ¼ã¾ãŸã¯Jã‚­ãƒ¼ã‚’é¸æŠã—ã¦ãã ã•ã„ï¼";
                setTimeout(() => {
                    document.getElementById("error").innerText = "";
                }, 1000);
                return;
            }
            
            // æ­£èª¤åˆ¤å®šã¨çµæœè¡¨ç¤º
            const resultText = document.getElementById("resultText");
            const resultImage = document.getElementById("resultImage");
            
            if (selectedKey === practiceTarget) {
                if (practiceTarget === "f") {
                    resultText.innerText = "æ­£è§£ã§ã™ğŸ”¥ï¼‘ç•ªç›®ãŒã‚¿ãƒ¼ã‚²ãƒƒãƒˆã§ã—ãŸ";
                    resultImage.innerHTML = "<img src='static/sample_fig/trial_target_first.png' style='height: 100px;'>";
                } else if (practiceTarget === "j") {
                    resultText.innerText = "æ­£è§£ã§ã™ğŸ”¥ï¼“ç•ªç›®ãŒã‚¿ãƒ¼ã‚²ãƒƒãƒˆã§ã—ãŸ";
                    resultImage.innerHTML = "<img src='static/sample_fig/trial_target_third.png' style='height: 100px;'>";
                }
            } else {
                if (practiceTarget === "f") {
                    resultText.innerText = "ä¸æ­£è§£ã§ã™ğŸ’¦ï¼‘ç•ªç›®ãŒã‚¿ãƒ¼ã‚²ãƒƒãƒˆã§ã—ãŸ";
                    resultImage.innerHTML = "<img src='static/sample_fig/trial_target_first.png' style='height: 100px;'>";
                } else if (practiceTarget === "j") {
                    resultText.innerText = "ä¸æ­£è§£ã§ã™ğŸ’¦ï¼“ç•ªç›®ãŒã‚¿ãƒ¼ã‚²ãƒƒãƒˆã§ã—ãŸ";
                    resultImage.innerHTML = "<img src='static/sample_fig/trial_target_third.png' style='height: 100px;'>";
                }
            }
            
            // ã‚¨ãƒ©ãƒ¼è¡¨ç¤ºã‚’ã‚¯ãƒªã‚¢
            document.getElementById("error").innerText = "";
            selectedKey = null;
        });
        
        // ã‚­ãƒ¼å…¥åŠ›ã®ãƒªã‚¹ãƒŠãƒ¼
        document.addEventListener("keydown", (event) => {
            const errorElement = document.getElementById("error");
            const resultText = document.getElementById("resultText");
            const resultImage = document.getElementById("resultImage");

            if (event.code === "KeyF") {
                selectKey("f");
            } else if (event.code === "KeyJ") {
                selectKey("j");
            } else if (event.code === "Space") {
                // éŸ³å£°å†ç”Ÿä¸­ã®ã‚¨ãƒ©ãƒ¼ãƒã‚§ãƒƒã‚¯ã‚’æœ€å„ªå…ˆ
                if (!isTrialRunning) {
                    errorElement.innerText = "å•é¡ŒãŒå†ç”Ÿã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚å†ç”Ÿãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚";
                    return;
                }
                if (isAudioPlaying) {
                    errorElement.innerText = "éŸ³å£°å†ç”Ÿä¸­ã§ã™ã€‚ã™ã¹ã¦ã®éŸ³ãŒå†ç”Ÿã•ã‚ŒãŸå¾Œã§å¿œç­”ã—ã¦ãã ã•ã„ã€‚";
                    setTimeout(() => {
                        errorElement.innerText = "";
                    }, 1000);
                    return;
                }

                // é¸æŠã•ã‚Œã¦ã„ãªã„å ´åˆã®ã‚¨ãƒ©ãƒ¼ãƒã‚§ãƒƒã‚¯
                if (!selectedKey) {
                    errorElement.innerText = "Fã‚­ãƒ¼ã¾ãŸã¯Jã‚­ãƒ¼ã‚’é¸æŠã—ã¦ãã ã•ã„ï¼";
                    setTimeout(() => {
                        errorElement.innerText = "";
                    }, 1000);
                    return;
                }

                if (selectedKey === practiceTarget) {
                    if (practiceTarget === "f") {
                        resultText.innerText = "æ­£è§£ã§ã™ğŸ”¥ï¼‘ç•ªç›®ãŒã‚¿ãƒ¼ã‚²ãƒƒãƒˆã§ã—ãŸ";
                        resultImage.innerHTML = "<img src='static/sample_fig/trial_target_first.png' style='height: 100px;'>";
                    } else if (practiceTarget === "j") {
                        resultText.innerText = "æ­£è§£ã§ã™ğŸ”¥ï¼“ç•ªç›®ãŒã‚¿ãƒ¼ã‚²ãƒƒãƒˆã§ã—ãŸ";
                        resultImage.innerHTML = "<img src='static/sample_fig/trial_target_third.png' style='height: 100px;'>";
                    }
                } else {
                    if (practiceTarget === "f") {
                        resultText.innerText = "ä¸æ­£è§£ã§ã™ğŸ’¦ï¼‘ç•ªç›®ãŒã‚¿ãƒ¼ã‚²ãƒƒãƒˆã§ã—ãŸ";
                        resultImage.innerHTML = "<img src='static/sample_fig/trial_target_first.png' style='height: 100px;'>";
                    } else if (practiceTarget === "j") {
                        resultText.innerText = "ä¸æ­£è§£ã§ã™ğŸ’¦ï¼“ç•ªç›®ãŒã‚¿ãƒ¼ã‚²ãƒƒãƒˆã§ã—ãŸ";
                        resultImage.innerHTML = "<img src='static/sample_fig/trial_target_third.png' style='height: 100px;'>";
                    }

                // ã‚¨ãƒ©ãƒ¼è¡¨ç¤ºã‚’ã‚¯ãƒªã‚¢
                errorElement.innerText = "";
                selectedKey = null;
                }
            }
        });

        document.addEventListener("DOMContentLoaded", () => {
        // æ—¢å­˜ã®åˆæœŸåŒ–å‡¦ç†
        updateDots();

        // ç·´ç¿’å•é¡Œå†ç”Ÿãƒœã‚¿ãƒ³ã®ã‚¹ãƒšãƒ¼ã‚¹ã‚­ãƒ¼æŠ¼ä¸‹ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã™ã‚‹
        const startBtn = document.getElementById("startPracticeBtn");
        const replayBtn = document.getElementById("replayTrialBtn");
        if (startBtn) {
            startBtn.addEventListener("keydown", (event) => {
            if (event.code === "Space") {
                event.preventDefault();
            }
            });
        }
        if (replayBtn) {
            replayBtn.addEventListener("keydown", (event) => {
            if (event.code === "Space") {
                event.preventDefault();
            }
            });
        }
        });

        
        // ã‚­ãƒ¼é¸æŠå‡¦ç†
        function selectKey(key) {
            selectedKey = key;

            // é¸æŠçŠ¶æ…‹ã‚’è¦–è¦šçš„ã«è¡¨ç¤º
            document.getElementById("buttonF").classList.remove("selected");
            document.getElementById("buttonJ").classList.remove("selected");

            if (key === "f") {
                document.getElementById("buttonF").classList.add("selected");
            } else if (key === "j") {
                document.getElementById("buttonJ").classList.add("selected");
            }

            // ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ã‚¯ãƒªã‚¢
            document.getElementById("error").innerText = "";
        }

        // ã‚¹ãƒ©ã‚¤ãƒ‰å‡¦ç†
        let currentSlide = 0;

        function updateSlidePosition() {
        const sliderWrapper = document.querySelector('.slider-wrapper');
        sliderWrapper.style.transform = 'translateX(' + (-currentSlide * 100) + '%)';
        updateDots(); // ã‚¹ãƒ©ã‚¤ãƒ‰ä½ç½®æ›´æ–°æ™‚ã«ãƒ‰ãƒƒãƒˆã‚‚æ›´æ–°
        }

        function nextSlide() {
        const slides = document.querySelectorAll('.slide');
        if (currentSlide < slides.length - 1) {
            currentSlide++;
            updateSlidePosition();
        }
        }

        function prevSlide() {
        if (currentSlide > 0) {
            currentSlide--;
            updateSlidePosition();
        }
        }

        function goToSlide(index) {
        currentSlide = index;
        updateSlidePosition();
        }

        function updateDots() {
        const dots = document.querySelectorAll('.dot');
        dots.forEach((dot, index) => {
            if (index === currentSlide) {
            dot.classList.add('active');
            } else {
            dot.classList.remove('active');
            }
        });
        }

        // åˆæœŸçŠ¶æ…‹ã®ãƒ‰ãƒƒãƒˆã‚’æ›´æ–°
        document.addEventListener("DOMContentLoaded", updateDots);
                
        // ç·´ç¿’ãƒˆãƒ©ã‚¤ã‚¢ãƒ«é–‹å§‹å‡¦ç†
        function startPracticeTrial() {
            console.log("startPracticeTrial");
            const freqSelect = document.getElementById("frequencyDirSelect");
            const frequencyDir = freqSelect.value;  // ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ã‹ã‚‰é¸æŠã•ã‚ŒãŸå‘¨æ³¢æ•°æ¡ä»¶ï¼ˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªåï¼‰
            document.getElementById("trialArea").style.display = "block";
            document.getElementById("resultText").innerText = "";
            document.getElementById("resultImage").innerHTML = "";
            
            // ãƒ©ãƒ³ãƒ€ãƒ ã« tone1 ã¾ãŸã¯ tone3 ã‚’ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã«ã™ã‚‹
            let targetPosition = Math.random() < 0.5 ? 1 : 3;
            practiceTarget = (targetPosition === 1) ? "f" : "j";
            
            // tone2 ã¯å¸¸ã«é€šå¸¸éŸ³ (offset 0.00ms)
            // tone1 ã¨ tone3 ã¯ã€ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãªã‚‰ offset 64.00msã€ãã†ã§ãªã‘ã‚Œã° 0.00ms ã®éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«
            let tone1Path, tone2Path, tone3Path;
            if (targetPosition === 1) {
                // tone1 ãŒã‚¿ãƒ¼ã‚²ãƒƒãƒˆ
                tone1Path = `/static/stimuli/successive_0.52*4/${frequencyDir}/gallops_64.00ms.wav`;
                tone2Path = `/static/stimuli/successive_0.52*4/${frequencyDir}/gallops_0.00ms.wav`;
                tone3Path = `/static/stimuli/successive_0.52*4/${frequencyDir}/gallops_0.00ms.wav`;
            } else {
                // tone3 ãŒã‚¿ãƒ¼ã‚²ãƒƒãƒˆ
                tone1Path = `/static/stimuli/successive_0.52*4/${frequencyDir}/gallops_0.00ms.wav`;
                tone2Path = `/static/stimuli/successive_0.52*4/${frequencyDir}/gallops_0.00ms.wav`;
                tone3Path = `/static/stimuli/successive_0.52*4/${frequencyDir}/gallops_64.00ms.wav`;
            }

            currentTonePaths = { tone1: tone1Path, tone2: tone2Path, tone3: tone3Path };
            
            isTrialRunning = true;
            isAudioPlaying = true;
            
            // å„éŸ³å£°ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ç”Ÿæˆã—ã€é †ã«å†ç”Ÿ
            const audio1 = new Audio(tone1Path);
            const audio2 = new Audio(tone2Path);
            const audio3 = new Audio(tone3Path);
            
            audio1.play();
            audio1.onended = () => {
                setTimeout(() => {
                audio2.play();
                audio2.onended = () => {
                    setTimeout(() => {
                    audio3.play();
                    audio3.onended = () => {
                        isAudioPlaying = false;  // å…¨ã¦å†ç”Ÿå®Œäº†
                    };
                    }, 500);
                };
                }, 500);
            };
        }

        function replayTrial() {
            if (!currentTonePaths) return;  // ã¾ã ä¿å­˜ã•ã‚Œã¦ã„ãªã„å ´åˆã¯ä½•ã‚‚ã—ãªã„
            if (isAudioPlaying) return;  // å†ç”Ÿä¸­ã¯ä½•ã‚‚ã—ãªã„
            isTrialRunning = true;
            isAudioPlaying = true;
            
            const audio1 = new Audio(currentTonePaths.tone1);
            const audio2 = new Audio(currentTonePaths.tone2);
            const audio3 = new Audio(currentTonePaths.tone3);
            
            audio1.play();
            audio1.onended = () => {
                setTimeout(() => {
                    audio2.play();
                    audio2.onended = () => {
                        setTimeout(() => {
                            audio3.play();
                            audio3.onended = () => {
                                isAudioPlaying = false;
                            };
                        }, 500);
                    };
                }, 500);
            };
        }

        function playSlide2Trial() {
            // frequencyDirã¯å›ºå®šã§ "as_semitone"
            // ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã‚’å›ºå®šå€¤ã§ç”Ÿæˆï¼ˆå¿…è¦ã«å¿œã˜ã¦ã€ãƒ‘ã‚¹å†…ã®ç‰¹æ®Šæ–‡å­—ã®æ‰±ã„ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼‰
            const tone1Path = `/static/stimuli/successive_0.52*4/as_semitone/gallops_0.00ms.wav`;
            const tone2Path = `/static/stimuli/successive_0.52*4/as_semitone/gallops_0.00ms.wav`;
            const tone3Path = `/static/stimuli/successive_0.52*4/as_semitone/gallops_64.00ms.wav`;

            // å„éŸ³å£°ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ç”Ÿæˆ
            const audio1 = new Audio(tone1Path);
            const audio2 = new Audio(tone2Path);
            const audio3 = new Audio(tone3Path);
            
            audio1.play().catch((e) => console.error("audio1 play error:", e));
            audio1.onended = () => {
                setTimeout(() => {
                audio2.play().catch((e) => console.error("audio2 play error:", e));
                audio2.onended = () => {
                    setTimeout(() => {
                    audio3.play().catch((e) => console.error("audio3 play error:", e));
                    audio3.onended = () => {
                    };
                    }, 500);
                };
                }, 500);
            };
            }

        // /experimentã¸é€²ã‚€
        function finishPractice() {
            window.location.href = "/experiment";
        }
    </script>
</body>
</html>
