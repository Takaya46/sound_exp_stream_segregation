<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®Ÿé¨“çµæœ</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body>
    <h1>ğŸŒ¸çµæœç™ºè¡¨ğŸŒ¸</h1>
    
    <!-- çµæœã‚µãƒãƒªãƒ¼ãƒ†ãƒ¼ãƒ–ãƒ« -->
    <div class="container">
        <h2>{{ session['participant_id'] }}ã•ã‚“ã®ãƒ¬ãƒ™ãƒ«è¨ºæ–­ğŸ“Š</h2>
        {% if has_questionnaire %}
        <div style="background-color: #e8f5e8; padding: 15px; border-radius: 8px; margin: 20px 0; text-align: center;">
            <h3 style="margin: 0; color: #2d5a2d;">ğŸµ éŸ³æ¥½çµŒé¨“ã‚¹ã‚³ã‚¢: {{ questionnaire_score }}/49ç‚¹</h3>
            <p style="margin: 5px 0; font-size: 14px; color: #555;">ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆå›ç­”ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸï¼</p>
        </div>
        {% endif %}
        <table style="width: 100%; border-collapse: collapse; margin: 20px 0;">
            <thead>
                <tr style="background-color: #f8f9fa;">
                    <th style="border: 1px solid #ddd; padding: 12px; text-align: left;">éŸ³æ¡ä»¶</th>
                    <th style="border: 1px solid #ddd; padding: 12px; text-align: center;">é–¾å€¤</th>
                    <th style="border: 1px solid #ddd; padding: 12px; text-align: center;">ãƒ¬ãƒ™ãƒ«</th>
                </tr>
            </thead>
            <tbody>
                {% for result in results_list %}
                <tr>
                    <td style="border: 1px solid #ddd; padding: 12px; font-weight: bold;">{{ result.frequency_label }}</td>
                    <td style="border: 1px solid #ddd; padding: 12px; text-align: center;">{{ result.log2_threshold }}</td>
                    <td style="border: 1px solid #ddd; padding: 12px; text-align: center; font-size: 18px; font-weight: bold;">{{ result.level }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        
        <div style="background-color: #f8f9fa; padding: 15px; border-radius: 8px; margin: 20px 0;">
            <h4 style="margin-top: 0;">ãƒ¬ãƒ™ãƒ«åˆ¤å®šåŸºæº–</h4>
            <div style="font-size: 14px; line-height: 1.5;">
                <strong>åŒã˜éŸ³ãƒ»åŠéŸ³ä¸Š:</strong> 0-2: å¤©æ‰ï¼ğŸŒŸ | 2-2.5: ã‚¨ã‚­ã‚¹ãƒ‘ãƒ¼ãƒˆğŸ¯ | 2.5-3: ã‚¹ã‚­ãƒ«ãƒ‰ğŸ’ª | 3-: ãƒ•ã‚¡ã‚¤ã‚¿ãƒ¼âš¡<br>
                <strong>1ã‚ªã‚¯ã‚¿ãƒ¼ãƒ–:</strong> -2.5: å¤©æ‰ï¼ğŸŒŸ | 2.5-3.0: ã‚¨ã‚­ã‚¹ãƒ‘ãƒ¼ãƒˆğŸ¯ | 3-3.5: ã‚¹ã‚­ãƒ«ãƒ‰ğŸ’ª | 3.5-: ãƒ•ã‚¡ã‚¤ã‚¿ãƒ¼âš¡<br>
                <strong>2ãƒ»3ã‚ªã‚¯ã‚¿ãƒ¼ãƒ–:</strong> -3: å¤©æ‰ï¼ğŸŒŸ | 3-4: ã‚¨ã‚­ã‚¹ãƒ‘ãƒ¼ãƒˆğŸ¯ | 4-5: ã‚¹ã‚­ãƒ«ãƒ‰ğŸ’ª | 5-: ãƒ•ã‚¡ã‚¤ã‚¿ãƒ¼âš¡
            </div>
        </div>
    </div>
    
    <!-- ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆçµæœã®å›³è¡¨ç¤º -->
    {% if has_questionnaire and survey_figure_path %}
    <div class="container" style="margin-top: 30px;">
        <h2>ğŸµ éŸ³æ¥½çµŒé¨“ã¨å®Ÿé¨“çµæœã®æ¯”è¼ƒåˆ†æ</h2>
        <p>
            ã‚ãªãŸã®å®Ÿé¨“çµæœï¼ˆèµ¤ã„ç‚¹ï¼‰ã‚’ä»–ã®å‚åŠ è€…ãƒ‡ãƒ¼ã‚¿ã¨æ¯”è¼ƒã—ãŸå›³ã§ã™ã€‚<br>
            æ¨ªè»¸ã¯éŸ³æ¥½çµŒé¨“ã‚¹ã‚³ã‚¢ã€ç¸¦è»¸ã¯75%æ¤œå‡ºé–¾å€¤ã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚
        </p>
        {% if survey_results %}
        <div style="background-color: #f0f8ff; padding: 15px; border-radius: 8px; margin: 15px 0;">
            <h3 style="margin-top: 0;">ğŸ“Š ã‚ãªãŸã®çµæœåˆ†æ</h3>
            {% for metric in survey_results.metrics_by_group %}
            <div style="margin: 10px 0;">
                <strong>{{ metric.group }}:</strong>
                {% if metric.hensachi and not (metric.hensachi|string == 'nan') %}
                    åå·®å€¤ {{ "%.1f"|format(metric.hensachi) }}
                    {% if metric.rank and metric.n > 0 %}
                        ({{ metric.rank }}/{{ metric.n }}ä½)
                    {% endif %}
                    {% if metric.percentile and not (metric.percentile|string == 'nan') %}
                        - ä¸Šä½{{ "%.1f"|format(100-metric.percentile) }}%
                    {% endif %}
                {% else %}
                    ãƒ‡ãƒ¼ã‚¿ãŒä¸ååˆ†ã§ã™
                {% endif %}
            </div>
            {% endfor %}
            {% if survey_results.overall.hensachi_mean and not (survey_results.overall.hensachi_mean|string == 'nan') %}
            <div style="margin-top: 15px; padding: 10px; background-color: #e8f5e8; border-radius: 5px;">
                <strong>å…¨ä½“å¹³å‡åå·®å€¤: {{ "%.1f"|format(survey_results.overall.hensachi_mean) }}</strong>
            </div>
            {% endif %}
        </div>
        {% endif %}
        <div class="image-container">
            <img src="{{ url_for('static', filename=survey_figure_path) }}" alt="éŸ³æ¥½çµŒé¨“ã¨å®Ÿé¨“çµæœã®æ¯”è¼ƒ" class="responsive-image" style="max-width: 100%; max-height: 400px; height: auto; object-fit: contain;">
        </div>
    </div>
    {% endif %}

    <div class="container">
        <h2>å¿ƒç†æ¸¬å®šé–¢æ•°ğŸ“ˆ</h2>
        <p>
            æ¨ªè»¸ãŒãƒªã‚ºãƒ ã®å¤‰åŒ–é‡(å¤§ãã„ã»ã©å¤‰åŒ–ãŒå¤§ãã„)ã€ç¸¦è»¸ãŒäºˆæ¸¬ã•ã‚Œã‚‹æ­£è§£ç¢ºç‡ã‚’ç¤ºã—ã¦ã„ã¾ã™<br>
            75%æ¤œå‡ºé–¾(ç‚¹ç·š)ãŒå°ã•ã„ã»ã©ãƒªã‚ºãƒ ã®å¤‰åŒ–ãŒå°‘ãªã„éŸ³ã§ã‚‚æ­£è§£ã§ãã‚‹ã“ã¨ã‚’ç¤ºã—ã¦ã„ã¾ã™ğŸ‘
        </p>
        {% for result in results_list %}
        <div class="image-container">
            <h2>{{ result.frequency_label }}</h2>
            <p>
                75%æ¤œå‡ºé–¾: {{ result.threshold }} ms (log2: {{ result.log2_threshold }})<br>
            </p>
            <img src="{{ url_for('static', filename=result.fig_path) }}" alt="{{ result.frequency_label }} MLE Curve" class="responsive-image">
        </div>
        {% endfor %}
        
        <p></p>
        <!-- ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆã¨ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã«æˆ»ã‚‹ãƒœã‚¿ãƒ³ -->
        <div style="display: flex; flex-direction: column; align-items: center; gap: 15px; margin: 30px 0;">
            {% if not has_questionnaire %}
            <button onclick="window.location.href='/questionnaire'" style="background-color: #ff6b35; color: white; border: none; padding: 15px 30px; font-size: 18px; border-radius: 8px; cursor: pointer; transition: background-color 0.3s ease;">
                ğŸ“ éŸ³æ¥½çµŒé¨“ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆï¼ˆä»»æ„ï¼‰
            </button>
            {% endif %}
            <button onclick="window.location.href='/'" style="background-color: #6c757d; color: white; border: none; padding: 15px 30px; font-size: 18px; border-radius: 8px; cursor: pointer; transition: background-color 0.3s ease;">
                ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã«æˆ»ã‚‹
            </button>
        </div>
        
    </div>
</body>
</html>